<ol class="breadcrumb">
  <li><%= link_to home_title, root_path %></li>
  <li><%= link_to "Topics", topics_path %></li>
  <li><em><%= link_to  @topic.name, topic_path %></em></li>
</ol>

<h1><%= @topic.name %></h1>

<% if policy(@topic).update? %>
<p>
  <%= link_to "Edit Topic", edit_topic_path, class: 'btn btn-success' %>
</p>
<% end %>

<div class="row">
  <div class="col-md-8">
    <p class="lead"><%= @topic.description %></p>
    <% if policy(Post.new).create? %>
    <p>
      <%= link_to "Create New Topic Post in #{@topic.name}", new_topic_post_path(@topic), class: 'btn btn-success' %>
    </p>
  <% end %>
  <!-- Add Related Post Header if other posts in this topic -->
  <% if !@topic.posts.empty? %>
  <div class="page-header">
    <h3>Related Posts</h3>
  </div>
  <% end %>

  <!-- Loop through each post in a given topic/category -->
  <div class="bloccit_pagination">
      <%= will_paginate @posts, :container => false %>
    </div>
  <% @topic.posts.each do |post| %>
    <div class="media">
    <!-- Pull the post image left, or use default image -->
      <a class="pull-left" href="#">
        <% if post.image? %>
          <%=  image_tag(post.image.image_thumb.url, class: 'media-object thumbnail') %>
        <% else %>
          <%= image_tag('fallback/default_image.jpg', class: 'media-object thumbnail', height: '55px', width: '80px') %>
        <% end %>
      </a>
      <div class="media-body">
        <h4 class="media-heading">
          <%= link_to markdown(post.title), [@topic, post] %>
        </h4>
        <small>
           <%= render_tiny_author_avatar_for(post.user) %>
           submitted <%= time_ago_in_words(post.created_at) %> ago by <em><%= post.user.name %></em> in <%= link_to post.topic.name, topic_path(post.topic) %> | Comments (<%= post.comments.count %>) | Views (<%= post.views %>)
          </small>
        </div>
      </div>
    <% end %>
    <!-- Post Pagination -->
    <div class="bloccit_pagination">
      <%= will_paginate @posts, :container => false %>
    </div>
  </div>
<!--Sidebar Column -->
  <div class="col-md-4">

    <% if !@topic.posts.empty? %>
      <!-- Nav tabs -->
      <ul class="nav nav-tabs">
        <li class="active"><a href="#popular" data-toggle="tab">Popular Posts</a></li>
        <li><a href="#latest" data-toggle="tab">Latest Posts</a></li>
      </ul>
      <!-- Tab panes -->
      <div class="tab-content">
        <!--Popular Posts -->
        <div class="tab-pane active" id="popular">
           <%= render partial: 'popular_posts', locals: { topic: @topic, post: @post } %>
        </div>
        <!--Latest Posts -->
        <div class="tab-pane" id="latest">
          <%= render partial: 'latest_posts', locals: { topic: @topic, post: @post } %>
        </div>
      </div>
    <% end %>
  </div>
</div>

